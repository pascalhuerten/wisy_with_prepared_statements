/*
ARIA Menubar Module for jQuery
Built by Bryan Garaventa, distributed under the OSI-MIT License.
*/
(function(a){window.ARIAMenuBar=function(d){d=d||{};var i=this;var j=d.topMenuBarSelector||'ul[role="menubar"]',o=d.hiddenClass||"hidden",l=function(r){if(typeof d.handleMenuItemClick==="function"){d.handleMenuItemClick.apply(this,[r])}else{top.location.href=this.href}},m=function(r,s){a(s).data("open",r);a(r).data("index",0);if(typeof d.openMenu==="function"){d.openMenu.apply(this,[r,s])}else{a(r).removeClass(o);if(i.cb&&typeof i.cb==="function"){i.cb();i.cb=null}}},k=function(s,x,t){if(!s){return}var t=t||a(s).data("menuBar");if(x){var v=a(t).data("subMenus");for(var u=0;u<v.length;u++){k.apply(this,[v[u],false,t])}}else{var w=a(s).data("triggeringMenuItem"),r=a(w).data("menuContainer");a(r).data("open",null);a(a(r).data("menuItems")[a(r).data("index")]).attr("tabindex",0);if(s!=t){a(s).data("index",0);if(typeof d.closeMenu==="function"){d.closeMenu.apply(this,[s])}else{a(s).addClass(o)}}a(a(s).data("menuItems")).attr("tabindex",-1)}},b=d.dualHorizontalTxt||"Press Enter to navigate to page, or Down to open dropdown",e=d.dualVerticalTxt||"Press Enter to navigate to page, or Right to open dropdown",h=d.horizontalTxt||"Press Down to open dropdown",c=d.verticalTxt||"Press Right to open dropdown",n=function(r){a(r).each(function(t,s){a(s).data("subMenus",[]);q(s,s,true);a(a(s).data("menuItems")[0]).attr("tabindex",0)})},q=function(u,s,r){var v=-1,w=null,t=[];if(a(u).attr("role")=="menubar"){v=a(u).hasClass("vertical")?false:true}else{if(a(u).attr("role")=="menu"){v=a(u).hasClass("horizontal")?true:false}}w=a(u).attr("id");if(v===-1){alert("Syntax error: menuContainer must include either role=menubar for the top level container, or role=menu for submenu structures.");return}else{if(!w){alert("Syntax error: All instances of menuContainer including role=menubar for the top level container, or role=menu for submenu structures, must include a unique ID.");return}}a(u).attr("aria-orientation",v?"horizontal":"vertical");a("#"+w+' > li > a[role="menuitem"]').each(function(y,z){a(z).data("menuContainer",a(u)[0]).data("isHorizontal",v).data("menuBar",a(s)[0]).attr("tabindex",-1);var A=a(z).attr("data-submenu-id")||null;if(A){var x=a("#"+A)[0]||null;if(!x){alert("Syntax error: data-submenu-id must reference a valid role=menu container.");return}a(z).attr("aria-haspopup","true");a(s).data("subMenus").push(a(x)[0]);a(z).data("subMenu",a(x)[0]).data("navigatesAway",a(z).hasClass("navigates-away")?true:false);if(!("ontouchstart" in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(a(z).data("navigatesAway")){if(v){a("<span>").css(p).appendTo(z).text(b)}else{a("<span>").css(p).appendTo(z).text(e)}}else{if(v){a("<span>").css(p).appendTo(z).text(h)}else{a("<span>").css(p).appendTo(z).text(c)}}}a(x).data("triggeringMenuItem",a(z)[0]).data("menuBar",a(s)[0]);a(x).bind({mouseleave:function(C){var B=a(this).data("open");if(!B){k.apply(this,[this])}C.stopPropagation()}});q(a(x)[0],a(s)[0])}t.push(a(z)[0])});f(t,r);a(u).data("menuItems",t).data("index",0)},f=function(s,r){if(!s.length){return}a(s).each(function(u,t){a(t).bind({keydown:function(D){var x=D.which||D.keyCode;if((x>=37&&x<=40)||x==13||x==32||x==27||x==9){var E=a(this).data("isHorizontal"),C=a(this).data("navigatesAway"),y=a(this).data("subMenu"),w=a(this).data("menuContainer"),z=a(w).data("index"),v=a(w).data("menuItems"),A=a(w).data("triggeringMenuItem"),F=a(A).data("menuContainer"),B=a(this).data("menuBar");if(x==37){if(E){if(!z){z=v.length-1}else{z--}a(w).data("index",z);g(a(v)[z],v)}else{k.apply(this,[w]);if(F&&F!=B&&A){g(a(F).data("menuItems")[a(F).data("index")],a(F).data("menuItems"),v)}else{if(F&&F==B&&A){z=a(B).data("index");v=a(B).data("menuItems");if(!z){z=v.length-1}else{z--}a(B).data("index",z);g(a(v)[z],v)}}}D.preventDefault()}else{if(x==38){if(!E){if(!z){z=v.length-1}else{z--}a(w).data("index",z);g(a(v)[z],v)}else{k.apply(this,[w])}D.preventDefault()}else{if(x==39){if(E){if(z>=v.length-1){z=0}else{z++}a(w).data("index",z);g(a(v)[z],v)}else{if(y){i.cb=function(){g(a(a(i.cb.subMenu).data("menuItems"))[0],a(i.cb.subMenu).data("menuItems"),i.cb.menuItems)};i.cb.subMenu=y;i.cb.menuItems=v;m.apply(this,[y,w])}else{k.apply(this,[w,true]);z=a(B).data("index");v=a(B).data("menuItems");if(z>=v.length-1){z=0}else{z++}a(B).data("index",z);g(a(v)[z],v)}}D.preventDefault()}else{if(x==40){if(!E){if(z>=v.length-1){z=0}else{z++}a(w).data("index",z);a(a(v)[z]).focus()}else{if(y){i.cb=function(){g(a(a(i.cb.subMenu).data("menuItems"))[0],a(i.cb.subMenu).data("menuItems"),i.cb.menuItems)};i.cb.subMenu=y;i.cb.menuItems=v;m.apply(this,[y,w])}}D.preventDefault()}else{if(x==13||x==32){if(y&&!C){i.cb=function(){g(a(a(i.cb.subMenu).data("menuItems"))[0],a(i.cb.subMenu).data("menuItems"),i.cb.menuItems)};i.cb.subMenu=y;i.cb.menuItems=v;m.apply(this,[y,w])}else{a(this).click()}D.preventDefault()}else{if(x==27||x==9){if(w==B){k.apply(this,[a(B).data("open"),true,B])}else{if(x==27&&F==B){a(B).data("stopFocus",true)}k.apply(this,[w,x==9?true:false,B]);if(x==27&&A){g(A,a(a(A).data("menuContainer")).data("menuItems"),v);D.preventDefault()}}}}}}}}}},click:function(y){var x=a(this).data("navigatesAway"),v=a(this).data("subMenu"),z=a(this).data("menuContainer"),w=a(this).data("menuBar");if(v&&!x){i.cb=function(){g(a(a(i.cb.subMenu).data("menuItems"))[0],a(i.cb.subMenu).data("menuItems"),i.cb.menuItems)};i.cb.subMenu=v;i.cb.menuItems=s;m.apply(this,[v,z])}else{k.apply(this,[z,true,w]);l.apply(this,[y])}y.preventDefault()}});if(r){a(t).bind({"focus mouseenter":function(A){var z=this,B=a(z).data("menuContainer"),w=a(z).data("subMenu"),y=a(z).data("menuBar"),x=a(y).data("open"),v=a(y).data("stopFocus");if(x&&x!=w){k.apply(this,[x,true,y]);x=null}if(!x&&w&&!v){m.apply(this,[w,y])}a(y).data("stopFocus",null)}})}})},g=function(s,r,t){a(t).attr("tabindex","-1");a(r).attr("tabindex","-1");a(s).attr("tabindex","0").focus()},p={position:"absolute",clip:"rect(1px 1px 1px 1px)",clip:"rect(1px, 1px, 1px, 1px)",padding:0,border:0,height:"1px",width:"1px",overflow:"hidden",zIndex:-1000};n(j)}})($);